# Документация

## Типы архивов

Я нигде не встречал описание правил, согласно которому релиз группы должны упаковывать свои релизы, но судя по моему опыту вот с чем мы можем столкнуться:

1. Все внешние архивы имеют формат `rar`
   - Судя по тому, в каких форматах я скачивал файлы с популярных варез-сайтов - все внешние архивы (то есть файлы-архивы которые вы скачиваете, внутри которых находились другие мелкие архивы) имеют расширение `.rar`
   - Один мой друг, который публиковал материал на sanet сказал мне, что на тот сайт допускаются архивы только в формате `.rar`
2. Внутренность архивов не имеет четкой структуры

Если вы скачиваете архивы с публичных и популярных варез-сайтов, то, скорее всего, внутри таких архивов не будет множество мелких архивов, а будут уже непосредственно файлы готовые к использованию. Достаточно будет распаковать этот скачанный архив и все готово.

Если вы скачиваете архивы с зеркальных сервисов для сцен или с самих сцен, то, скорее всего, внутри таких архивов будет множество мелких архивов, внутри которых могут быть как нужные вам файлы, так и другие мелкие архивы или части 1 большого архива.

Я видел несколько вариантов такой упаковки мелких архивов.

## Возможные структуры архивов с частями внутри

Основной/внешний архив, который мы скачиваем это как правило 1 rar-архив.

Но то, что нам нужно находится внутри и не сразу в готовом виде. Весь набор файлов релиза (например программа в exe-формате и файл .nfo) сжимается в rar-архив с параметром разделения на части определенного размера. Потом все эти части + файл .nfo + файл file_id.diz упаковывают в обычный rar-архив без какого-либо разделения.

Вот какие варианты упаковки мелких архивов в 1 общий архив:

1. Релиз упакован в rar-архив разделенный на части с расширением `.rXX` на конце
```
best.app.rar
├ best.app.rar
├ best.app.r00
├ best.app.r01
├ some.team.nfo
└ file_id.diz
```
И при распаковке частей rar-архива, то есть файлов `.rXX` мы получим файлы релиза.

2. Релиз упакован в rar-архив разделенный на части с расширением `.partXX.rar` на конце
```
best.app.rar
├ best.app.part1.rar
├ best.app.part2.rar
├ best.app.part3.rar
├ some.team.nfo
└ file_id.diz
```
И при распаковке частей rar-архива, то есть файлов `.partXX.rar` мы получим файлы релиза.

3. Тоже, что и вариант 1, но каждая часть вместе с `.nfo` и `.diz` файлами упакована в zip-архив.
```
best.app.rar
├ best.app-1.zip
│ ├ best.app.rar
│ ├ some.team.nfo
│ └ file_id.diz
├ best.app-2.zip
│ ├ best.app.r00
│ ├ some.team.nfo
│ └ file_id.diz
├ best.app-3.zip
│ ├ best.app.r00
│ ├ some.team.nfo
│ └ file_id.diz
├ some.team.nfo
└ file_id.diz
```
И сначала необходимо распаковать все zip-архивы, решая конфликты слияния (то есть выбирая заменять файлы `.nfo` и `.diz` на те, что есть архиве или пропустить замену), а потом уже распаковывать rar-архив разделенный на части

4. Тоже, что и вариант 2, но каждая часть вместе с `.nfo` и `.diz` файлами упакована в zip-архив.
```
best.app.rar
├ best.app-1.zip
│ ├ best.app.part1.rar
│ ├ some.team.nfo
│ └ file_id.diz
├ best.app-2.zip
│ ├ best.app.part2.rar
│ ├ some.team.nfo
│ └ file_id.diz
├ best.app-3.zip
│ ├ best.app.part3.rar
│ ├ some.team.nfo
│ └ file_id.diz
├ some.team.nfo
└ file_id.diz
```
И сначала необходимо распаковать все zip-архивы, решая конфликты слияния (то есть выбирая заменять файлы `.nfo` и `.diz` на те, что есть архиве или пропустить замену), а потом уже распаковывать rar-архив разделенный на части

> Разница между частями rar-архива в формате `.rXX` и `.partXX.rar` заключается в том, что части `.rXX` это формат RAR4 и он считается устаревшим и начиная с WinRAR 7 создание rar-архива разделенного на такие части больше не поддерживается. Формат частей `.partXX.rar` считается современным и именно в таком формате создаются части rar-архива в WinRAR 7 (ну и в предыдущих версиях тоже).

### Дополнительные нюансы:

Также стоит учитывать, что:

1. В корне каждого архива файлы могут находится в папке, а могут лежать кучей в самом архиве без какой-либо папки.
   - это может создать огромную вложенность и огромное количество папок, если частей много
2. Все это может измениться и быть кем-либо переупаковано и вместо частей rar-архивов там могут быть части zip-архивов или 7z-архивов
   - части zip-архива тоже могут быть как в формате `.zXX`, так и в `.zip.XXX`. Возможно и части 7z-архивов могут иметь несколько форматов
3. При открытии частей архива в файловом менеджере, при клике на какую-либо не-первую часть разделенного архива - архиватор автоматически находит первую часть и начинает анализ и открытие архива с первой части. Но если в CLI режиме архиватору указать для распаковки не первую часть, то он не будет искать первую, а попытается распаковать конкретно переданный файл
   - То есть искать первую часть архива и передавать ее архиватору понадобится самостоятельно

Суть скрипта, чтобы обработать все возможные нюансы и не тратить время на распаковку всех частей вручную.